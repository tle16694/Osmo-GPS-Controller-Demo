# 常见问题与解答

本文旨在解答在使用过程中可能遇到的一些常见问题。在阅读本文件前，请务必先完整且认真阅读以下相关文档，以确保对项目有充分了解：

[项目 README 文档](../README_CN.md)：介绍整个开源项目的背景与结构

[协议解析说明文档](protocol_CN.md)：快速了解 DJI R SDK 协议的基本组成

[DATA 数据段详细文档](protocol_data_segment_CN.md)：详解相机支持的各类命令及功能

[数据层说明文档](data_layer_CN.md)：数据中转层的设计原理与实现细节，供开发参考

[添加相机休眠功能-示例文档](add_camera_sleep_feature_example_CN.md)：演示如何为遥控器快速添加一个新的控制功能

提示：本 Demo 代码仅供参考。如遇到 BUG，建议将复现过程的视频或照片、输出日志及复现方法一并提交至 issue，我们将尽快处理。同时也欢迎您提交 PR，参与修复与优化。

## 1. 遥控器与相机通信时的特性值

| **特性** | **说明**                           |
| -------- | ---------------------------------- |
| 0xFFF4   | 相机发送，遥控器接收，需要使能通知 |
| 0xFFF5   | 相机接收，遥控器发送               |

参考代码：

```c
/* 这里定义想要过滤的 Service/Characteristic UUID，供搜索使用 */
#define REMOTE_TARGET_SERVICE_UUID   0xFFF0
#define REMOTE_NOTIFY_CHAR_UUID      0xFFF4
#define REMOTE_WRITE_CHAR_UUID       0xFFF5
```

连接建立后，仅需处理以 `0xAA` 开头的帧（DJI R SDk Protocol），其他广播数据可直接忽略。

## 2. 如何休眠与唤醒相机？

相机既可以通过长按电源按键进入休眠状态，也可以通过遥控器操作实现休眠。长按遥控器上的拍录键，相机会进入休眠模式。休眠状态下，单击任意按键可唤醒相机；如果单击的是拍录键，相机将被唤醒并立即开始拍摄，拍摄结束后自动重新进入休眠状态。

请注意以下几点：

- 相机进入休眠后，请停止向相机发送任何数据。
- 收到相机的休眠应答后，即可视为相机已成功休眠，此时蓝牙连接仍会保持。
- 在相机休眠过程中，可能仍会推送几帧状态数据，可安全忽略。
- 当相机被唤醒时，其蓝牙连接会短暂断开，遥控器需自动完成重连。
- 想要广播唤醒目标相机，前提是最近一段时间先使用遥控器成功连接该相机。

详细实现参考：[DATA 数据段详细文档](protocol_data_segment_CN.md) 中的 **相机电源模式设置（001A）** 功能。

## 3. 如何屏蔽升级？

在连接请求协议中的 `fw_version` 字节位置填入 0，该操作需相机已更新至最新固件版本方可支持。

详细实现参考：[DATA 数据段详细文档](protocol_data_segment_CN.md) 中的 **连接请求（0019）** 功能。

## 4. 如何识别相机广播？

可通过判断厂商字段的特定字节来识别是否为支持的相机，判断逻辑如下：当厂商字段的第 0、1 和 4 字节分别为 0xAA、0x08 和 0xFA 时，表示该相机为支持设备。

详细实现参考 `ble.c` 文件中的 `bsp_link_is_dji_camera_adv` 函数。

## 5. 模拟 GPS 命令帧推送但是仪表盘数据异常？

不建议使用模拟数据方式构造 [DATA 数据段详细文档](protocol_data_segment_CN.md) 中的 **GPS 数据推送（0017）** 命令帧。因为仪表盘功能依赖这些数据，使用非真实数据可能导致 APP 中仪表盘显示异常。

真实构造的 GPS 命令帧可参考 `test_gps.c` 文件。在 `app_main.c` 中调用 `start_ble_packet_test(1)` 可实现以 1Hz 频率循环推送，供测试使用。后续我们将持续完善这些测试数据，也欢迎大家提交更多真实有效的测试样本。

## 6. 唤醒后 snapshot 功能实现

先通过广播唤醒数据以唤醒相机。

相机唤醒后，仅需上报快门键的单击事件。

相机拍摄 / 录制完成后将自动进入休眠状态。

详细实现参考：[DATA 数据段详细文档](protocol_data_segment_CN.md) 中的 **按键上报（0011）** 功能。

## 7. **倍率的计算**

慢动作下，倍率等于帧率 / 30。

运动延时下，倍率等于延时间隔。

静止延时下，没有倍率显示，只有间隔时间。

## 8. 相机模式对应 UI 设计

参考：[DATA 数据段详细文档](protocol_data_segment_CN.md) 中的 **相机状态推送（1D02）** 功能，后面有详细给出不同相机模式下，参数如何显示，如何与帧字段对应。
